# ===========================================
# ğŸ§± Go Redirect Service â€” Makefile
# ===========================================

# Nama binary yang dihasilkan
BINARY_NAME=redirect-service

# Lokasi direktori utama aplikasi
CMD_DIR=cmd/server

# Lokasi file wire.go
WIRE_DIR=cmd/server

# ===========================================
# ğŸ§© Perintah Development
# ===========================================

## Jalankan aplikasi dengan hot reload (pakai Air)
dev:
	@echo "ğŸš€ Starting ${BINARY_NAME} in development mode..."
	@air

## Generate dependency injection dengan Wire
wire:
	@echo "âš™ï¸  Generating dependency injection with Wire..."
	cd $(WIRE_DIR) && go run github.com/google/wire/cmd/wire
	@echo "âœ… Wire generation complete!"

## Install Air (hot reload) dan Wire (dependency injection)
setup:
	@echo "ğŸ“¦ Installing dev tools (air + wire)..."
	go install github.com/cosmtrek/air@latest
	go get github.com/google/wire/cmd/wire@v0.7.0
	@echo "âœ… Setup complete!"

# ===========================================
# ğŸ—ï¸ Build & Run
# ===========================================

## Build aplikasi (tanpa hot reload)
build:
	@echo "ğŸ—ï¸  Building ${BINARY_NAME}..."
	go build -o tmp/$(BINARY_NAME) $(CMD_DIR)
	@echo "âœ… Build complete: tmp/$(BINARY_NAME)"

## Jalankan hasil build
run:
	@echo "ğŸš€ Running ${BINARY_NAME}..."
	./tmp/$(BINARY_NAME)

## Bersihkan file hasil build
clean:
	@echo "ğŸ§¹ Cleaning up build files..."
	rm -rf tmp
	@echo "âœ… Cleanup done."
